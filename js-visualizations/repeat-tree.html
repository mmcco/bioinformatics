<!DOCTYPE html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

  </head>
  <body>

    <div id="viz"></div>

<script type="text/javascript">

      var treeData = {
        "name": "root",
        "size": 586095,
        "children": [
            {
                "name": "Simple_repeat",
                "size": 339815,
                "children": []
            },
            {
                "name": "Satellite",
                "size": 42256,
                "children": [
                    {
                        "name": "Satellite/telo",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "Satellite/centr",
                        "size": 532,
                        "children": []
                    },
                    {
                        "name": "Satellite/acro",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "LINE",
                "size": 8464,
                "children": [
                    {
                        "name": "LINE/L1",
                        "size": 11225989,
                        "children": []
                    },
                    {
                        "name": "LINE/L2",
                        "size": 457934,
                        "children": []
                    },
                    {
                        "name": "LINE/CR1",
                        "size": 12380,
                        "children": []
                    },
                    {
                        "name": "LINE/RTE-X",
                        "size": 5966,
                        "children": []
                    },
                    {
                        "name": "LINE/RTE-BovB",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "LINE/Jockey",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "LINE/Penelope",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "LINE/Dong-R4",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "LINE/L1-Tx1",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "DNA",
                "size": 10871,
                "children": [
                    {
                        "name": "DNA/hAT-Charlie",
                        "size": 96062,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT-Tip100",
                        "size": 3002,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar-Tigger",
                        "size": 181623,
                        "children": []
                    },
                    {
                        "name": "DNA/MULE-MuDR",
                        "size": 7192,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT-Blackjack",
                        "size": 2863,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT-Tag1",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT-Ac",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar-Tc2",
                        "size": 1919,
                        "children": []
                    },
                    {
                        "name": "DNA/PiggyBac",
                        "size": 1381,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT?",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar-Mariner",
                        "size": 292,
                        "children": []
                    },
                    {
                        "name": "DNA/hAT-Tip100?",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar-Tc1",
                        "size": 186,
                        "children": []
                    },
                    {
                        "name": "DNA/Kolobok",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/Merlin",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar-Pogo",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/TcMar?",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA/PIF-Harbinger",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "SINE",
                "size": 1450,
                "children": [
                    {
                        "name": "SINE/MIR",
                        "size": 134749,
                        "children": []
                    },
                    {
                        "name": "SINE/Alu",
                        "size": 13386380,
                        "children": []
                    },
                    {
                        "name": "SINE/tRNA-Deu",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "SINE/5S-Deu-L2",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "SINE/tRNA-RTE",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "SINE/tRNA",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "LTR",
                "size": 90009,
                "children": [
                    {
                        "name": "LTR/ERVL-MaLR",
                        "size": 1306331,
                        "children": []
                    },
                    {
                        "name": "LTR/ERVL",
                        "size": 209823,
                        "children": []
                    },
                    {
                        "name": "LTR/ERV1",
                        "size": 1054382,
                        "children": []
                    },
                    {
                        "name": "LTR/ERVL?",
                        "size": 140,
                        "children": []
                    },
                    {
                        "name": "LTR/ERV1?",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "LTR/ERVK",
                        "size": 127205,
                        "children": []
                    },
                    {
                        "name": "LTR/Gypsy",
                        "size": 3182,
                        "children": []
                    },
                    {
                        "name": "LTR/Gypsy?",
                        "size": 548,
                        "children": []
                    }
                ]
            },
            {
                "name": "Low_complexity",
                "size": 22165,
                "children": []
            },
            {
                "name": "LTR?",
                "size": 299,
                "children": []
            },
            {
                "name": "Retroposon",
                "size": 0,
                "children": [
                    {
                        "name": "Retroposon/SVA",
                        "size": 128830,
                        "children": []
                    }
                ]
            },
            {
                "name": "snRNA",
                "size": 55,
                "children": []
            },
            {
                "name": "tRNA",
                "size": 271,
                "children": []
            },
            {
                "name": "DNA?",
                "size": 15,
                "children": [
                    {
                        "name": "DNA?/hAT-Tip100?",
                        "size": 0,
                        "children": []
                    },
                    {
                        "name": "DNA?/PiggyBac?",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "srpRNA",
                "size": 0,
                "children": []
            },
            {
                "name": "rRNA",
                "size": 0,
                "children": []
            },
            {
                "name": "scRNA",
                "size": 0,
                "children": []
            },
            {
                "name": "RC",
                "size": 0,
                "children": [
                    {
                        "name": "RC/Helitron",
                        "size": 44,
                        "children": []
                    }
                ]
            },
            {
                "name": "RNA",
                "size": 0,
                "children": []
            },
            {
                "name": "RC?",
                "size": 0,
                "children": [
                    {
                        "name": "RC?/Helitron?",
                        "size": 0,
                        "children": []
                    }
                ]
            },
            {
                "name": "SINE?",
                "size": 0,
                "children": [
                    {
                        "name": "SINE?/tRNA",
                        "size": 0,
                        "children": []
                    }
                ]
            }
        ]
      };

      var d = new $.Deferred();
      var strokeColors = {};

      $(document).ready(function () {
          var width = $(window).width() - 65,
              height = $(window).height() - 65,
              diameter = width < height ? width : height;

          var diagonal = d3.svg.diagonal.radial()
              .projection(function (d) {
                  return [d.y, d.x / 180 * Math.PI];
              });

          var color = d3.scale.category20();

          var vis = d3.select("#viz").append("svg")
              .attr("width", diameter)
              .attr("height", diameter)
              .append("g")
              .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

          var tree = d3.layout.tree()
              .size([360, diameter / 2 - 150])
              .separation(function (a, b) {
                  return (a.parent == b.parent ? 1 : 2) / a.depth;
              });

          var nodes = tree.nodes(treeData);
          var link = vis.selectAll("pathlink")
              .data(tree.links(nodes))
              .enter().append("path")
              .attr("class", "link")
              .attr("d", diagonal);

          var node = vis.selectAll("g.node")
              .data(nodes)
              .enter().append("g")
              .attr("class", "node")
              .attr("num-kmers", function (d) {
                  return d.size;
              })
              .attr("name", function (d) {
                  return d.name;
              })
              .attr("transform", function (d) {
                  return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")";
              });

          node.append("circle")
              .attr("r", function () {
                  //console.log(jQuery($(this)).parent().attr("num-kmers"));
                  var logSize = Math.log(jQuery($(this)).parent().attr("num-kmers"));
                  //console.log(logSize);
                  return logSize < parseFloat(0) ? parseFloat(1) : logSize;
              })
              .style("stroke", function (d, i) {
                  var nodeName = $(this).parent().attr("name");
                  var ancestry = nodeName.split('/');
                  var depth = ancestry.length;
                  if (nodeName === "root") {
                      strokeColors[nodeName] = d3.hsl("black");
                  } else if (depth === 1) {
                      strokeColors[nodeName] = d3.hsl(color(i));
                      //return d3.hsl(parentCirc.attr("stroke")).brighter();
                  } else {
                      strokeColors[nodeName] = strokeColors[ancestry.slice(0, -1)].darker();
                  }
                  return strokeColors[nodeName];
              })
              .style("fill", function(d, i) {
                  return strokeColors[$(this).parent().attr("name")].brighter();
              });

          node.append("text")
              .attr("dy", ".31em")
              .attr("text-anchor", function (d) {
                  return d.x < 180 ? "start" : "end";
              })
              .attr("transform", function (d) {
                  var dotRad = jQuery($(this).parent()).find('circle').attr("r");
                  //console.log(d.name + " dotRad: " + dotRad)
                  var transDist = parseFloat(dotRad) + parseFloat(8);
                  //console.log(transDist);
                  return d.x < 180 ? "translate(" + transDist + ")" : "rotate(180)translate(" + -transDist + ")";
              })
              .text(function (d) {
                  return d.name;
              });

          d3.select(self.frameElement).style("height", diameter + "px");

          d.resolve();
      });

      $.when(d).done(function () {
          $('circle').on("mouseover", function () {
              $("#rep-info").text($(this).parent().attr("name"));
              $(this).css("fill", $(this).css("stroke"));
          });
          
          $('circle').on("mouseout", function () {
              $("#rep-info").text("");
              $(this).css("fill", strokeColors[$(this).parent().attr("name")].brighter());
          });
      });

</script>
    
<style>
.node circle {
  fill: #fff;
  stroke: steelblue;
  stroke-width: 2px;
}

.node {
  font: 12px Arial;
}

text {
  font-family: Arial;
}

.link {
  fill: none;
  stroke: #ccc;
  stroke-width: 1.5px;
}
</style>

	<p id="rep-info"></p>

  </body>
</html>
